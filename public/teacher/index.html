<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>知微课研数据显示屏</title>
    <link rel="stylesheet" href="css/index.css">
    <!-- 添加Socket.IO客户端库 -->
    <script src="https://lib.baomitu.com/socket.io/4.6.1/socket.io.js"></script>
</head>

<body>
    <div class="content-body">
        <div class="header">
            <div class="header-left fl"></div>
            <div class="header-center fl">
                <div class="header-title">
                    明瞳智教AI教学平台
                </div>
                <div class="header-img"></div>
            </div>
            <div class="header-right fl" id="time"></div>
            <div class="header-bottom fl"></div>
        </div>

        <div class="content">
            <div class="content-con">
                <div class="left-body">
                    <div class="left-top public-bg">
                        <div class="public-title">课程信息</div>
                        <div class="information">
                            <p>课程名称：数据结构与算法</p>
                            <p>课程教师：王某某</p>
                            <p>课程学分：5学分</p>
                            <p>课程学时：96学时</p>
                            <p>学院：某某学院</p>
                            <p>专业：某某专业</p>
                            <p>联系电话：123456789</p>
                        </div>
                    </div>

                    <div class="left-bottom public-bg">
                        <div class=" public-title">课堂认真top6
                            <button onclick="toggleFold()"><span class="arrow"><img src="image/left.png"
                                        style="width: 90%;height: 10%;"></span></button>
                        </div>
                        <div class="title-nav" id="top6">
                            <div class="foldable-section" id="foldableSection">
                                <div class="level">
                                    <img src="image/song.png" alt="Student 1" class="student-avatar">
                                    <img src="image/tang.png" alt="Student 1" class="student-avatar">
                                </div>
                                <div class="level">
                                    <img src="image/zhang.png" alt="Student 1" class="student-avatar">
                                    <img src="image/yang.png" alt="Student 1" class="student-avatar">
                                </div>
                                <div class="level">
                                    <img src="image/guo.png" alt="Student 1" class="student-avatar">
                                    <img src="image/song.png" alt="Student 1" class="student-avatar">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="center-body">
                    <div class="center-top public-bg">
                        <div class="public-title1"> 课堂情况回放</div>
                        <div class="course-selector">
                            <select class="data-select" id="dateSelect">
                                <option value="">选择日期</option>
                                <option value="2025-03-18">2025-03-18</option>
                                <option value="2025-03-15">2025-03-15</option>
                                <option value="2025-03-11">2025-03-11</option>
                                <option value="2025-03-08">2025-03-08</option>
                                <option value="2025-03-04">2025-03-04</option>
                                <option value="2025-03-01">2025-03-01</option>
                                <option value="2025-02-26">2025-02-26</option>
                                <option value="2025-02-23">2025-02-23</option>
                                <option value="2025-02-19">2025-02-19</option>
                                <option value="2025-02-16">2025-02-16</option>
                                <option value="2025-02-12">2025-02-12</option>
                                <option value="2025-02-09">2025-02-09</option>
                            </select>
                            <select class="data-select" id="courseSelect">
                                <option value="">选择课程</option>
                                <option value="shujujiegou">数据结构与算法</option>
                                <option value="jisuanjizucheng">计算机组成原理</option>
                                <option value="caozuoxitong">操作系统</option>
                                <option value="jisuanjiwangluo">计算机网络</option>
                                <option value="suanfasheji">算法设计与分析</option>
                                <option value="rengongzhineng">人工智能导论</option>
                                <option value="shujuku">数据库系统原理</option>
                                <option value="bianyiyuanli">编译原理</option>
                                <option value="ruanjiankaifa">软件工程与项目管理</option>
                                <option value="wangluoanquan">网络安全技术</option>
                            </select>
                            <button class="data-select" onclick="loadPlayback()">加载回放</button>
                        </div>
                        <div class="video-player-container">
                            <video id="videoPlayer" class="video-player" controls>
                                <source src="" type="video/mp4">
                                您的浏览器不支持 HTML5 视频播放。
                            </video>
                        </div>
                    </div>
                    <div class="center-bottom public-bg">
                        <div class="public-title">课后任务完成情况</div>
                        <div id="table-container">
                            <table id="data-table">
                                <thead>
                                    <tr>
                                        <th>姓名</th>
                                        <th>班级</th>
                                        <th>完成率</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


                <div class="right-body">
                    <div class="right-top public-bg">
                        <div class="public-title">课堂情况占比情况</div>
                        <div class="title-nav" id="piechart5"></div>
                    </div>
                    <div class="right-con public-bg">
                        <div class="public-title">与上节课相比</div>
                        <div class="title-nav" id="huaxing"></div>
                    </div>
                    <div class="right-bottom public-bg">
                        <div class="public-title">课堂实时情况</div>
                        <div class="title-nav" id="zhexian"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>

<script src="https://www.jq22.com/jquery/echarts-4.2.1.min.js"></script>
<script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>
<script type="text/javascript" src="js/china.js"></script>
<script type="text/javascript" src="js/huaxing.js"></script>
<script type="text/javascript" src="js/piechart5.js"></script>
<script type="text/javascript" src="js/zhexian.js"></script>
<script type="text/javascript" src="js/top6.js"></script>
<script type="text/javascript" src="js/container.js"></script>
<script>
    // 连接Socket.IO服务器
    const socket = io("http://127.0.0.1:3333", {
        transports: ['websocket'],
        reconnection: true,
        reconnectionAttempts: 5,
        reconnectionDelay: 1000
    });

    // 监听连接成功事件
    socket.on('connect', () => {
        console.log('已连接到服务器');
        // 发送初始消息
        socket.emit('sendFunEvent', {
            user: '系统',
            info: '页面已加载'
        });
    });

    // 监听连接错误事件
    socket.on('connect_error', (error) => {
        console.error('连接错误:', error);
    });

    // 监听断开连接事件
    socket.on('disconnect', (reason) => {
        console.log('断开连接:', reason);
    });

    // 监听服务器返回的消息
    socket.on('sendFunEventCallBack', (data) => {
        console.log('收到服务器消息:', data);
        // 这里可以处理收到的消息，比如更新页面内容
    });

    // 监听webEvent事件
    socket.on('webEvent', (data) => {
        console.log('收到webEvent消息:', data);
    });

    //顶部时间
    function getTime() {
        var myDate = new Date();
        var myYear = myDate.getFullYear(); //获取完整的年份(4位,1970-????)
        var myMonth = myDate.getMonth() + 1; //获取当前月份(0-11,0代表1月)
        var myToday = myDate.getDate(); //获取当前日(1-31)
        var myDay = myDate.getDay(); //获取当前星期X(0-6,0代表星期天)
        var myHour = myDate.getHours(); //获取当前小时数(0-23)
        var myMinute = myDate.getMinutes(); //获取当前分钟数(0-59)
        var mySecond = myDate.getSeconds(); //获取当前秒数(0-59)
        var week = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
        var nowTime;

        nowTime = myYear + '年' + fillZero(myMonth) + '月' + fillZero(myToday) + '日' + '&nbsp;&nbsp;' + fillZero(myHour) + ':' + fillZero(myMinute) + ':' + fillZero(mySecond) + '&nbsp;&nbsp;' + week[myDay] + '&nbsp;&nbsp;';
        //console.log(nowTime);
        $('#time').html(nowTime);
    };
    function fillZero(str) {
        var realNum;
        if (str < 10) {
            realNum = '0' + str;
        } else {
            realNum = str;
        }
        return realNum;
    }
    //大屏
    setInterval(getTime, 1000);
    // 处理课程回放加载
    function loadPlayback() {
        const date = document.getElementById('dateSelect').value;
        const course = document.getElementById('courseSelect').value;

        if (!date || !course) {
            alert('请选择日期和课程！');
            return;
        }

        // 设置视频源
        const videoPlayer = document.getElementById('videoPlayer');
        // 这里需要根据实际的视频文件路径进行设置
        videoPlayer.src = `videos/${date}_${course}.mp4`;

        // 刷新右侧三个图表
        refreshRightCharts();

        console.log(`加载 ${date} 的 ${course} 课程回放`);
    }

    // 刷新右侧三个图表
    function refreshRightCharts() {
        // 刷新课堂情况占比情况
        if (typeof piechart5 === 'function') {
            // 清除原有图表
            var pieChart = echarts.init(document.getElementById('piechart5'));
            pieChart.clear();
            // 重新初始化
            piechart5();
        }

        // 刷新与上节课相比数据
        if (typeof huaxing === 'function') {
            // 清除原有图表
            var huaxingChart = echarts.init(document.getElementById('huaxing'));
            huaxingChart.clear();
            // 重新初始化
            huaxing();
        }

        // 刷新PK情况
        if (typeof zhexian === 'function') {
            // 清除原有图表
            var pkChart = echarts.init(document.getElementById('zhexian'));
            pkChart.clear();
            // 重新初始化
            zhexian();
        }
    }
</script>

<style>
    /* 视频播放器样式 */
    .center-top.public-bg {
        position: relative;
        padding: 10px;
        box-sizing: border-box;
    }

    .course-selector {
        margin-bottom: 10px;
    }

    .video-player-container {
        width: calc(100% - 28px);
        height: 350px;
        margin: 0 14px;
        padding: 0;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    .video-player {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }
</style>